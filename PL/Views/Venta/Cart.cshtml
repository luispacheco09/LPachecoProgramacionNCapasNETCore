@*@model ML.VentaProducto*@
@model List<ML.VentaProducto>

@{
    ViewData["Title"] = "Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    decimal? Total = 0;
}
<h1>Cart</h1>
<div id="alert-message" class="alert fade">
    @* @ViewData["Mensaje"] *@
    @ViewBag.Mensaje
</div>
<div id="Cart-container">
    @if (Model.Count > 0)
    {
        <section class="h-100 gradient-custom">
            <div class="container py-5">
                <div class="row d-flex justify-content-center my-4">
                    <div class="col-md-8">
                        <div class="card mb-4">
                            <div class="card-header py-3">
                                <h5 class="mb-0">Cart - 2 items</h5>
                            </div>
                            @foreach (ML.VentaProducto ventaProducto in Model)
                            {
                                <div class="card-body">
                                    <!-- Single item -->
                                    <div class="row">
                                        <div class="col-lg-3 col-md-12 mb-4 mb-lg-0">
                                            <!-- Image -->
                                            <div class="bg-image hover-overlay hover-zoom ripple rounded" data-mdb-ripple-color="light">
                                                @*  <img src="https://mdbcdn.b-cdn.net/img/Photos/Horizontal/E-commerce/Vertical/12a.webp"
                                        class="w-100" alt="Blue Jeans Jacket" /> *@
                                                @if (ventaProducto.SucursalProducto.Producto.Imagen != null)
                                                {
                                                    <img src="data:image/jpg;base64,@Convert.ToBase64String(ventaProducto.SucursalProducto.Producto.Imagen)" class="w-100" />
                                                }
                                                else
                                                {
                                                    <img id="imgUsuario" src="~/Images/producto.png" style="width:150px; height:150px" />
                                                }
                                                <a href="#!">
                                                    <div class="mask" style="background-color: rgba(251, 251, 251, 0.2)"></div>
                                                </a>
                                            </div>
                                            <!-- Image -->
                                        </div>

                                        <div class="col-lg-5 col-md-6 mb-4 mb-lg-0">
                                            <!-- Data -->
                                            <p hidden><strong>IdSucursalProducto: @ventaProducto.SucursalProducto.IdSucursalProducto</strong></p>
                                            <p><strong>@ventaProducto.SucursalProducto.Producto.Nombre</strong></p>
                                            <p>Cantidad: @ventaProducto.Cantidad</p>
                                            <p>Precio Unitario: @ventaProducto.SucursalProducto.Producto.PrecioUnitario</p>
                                            <p>Modelo: @ventaProducto.SucursalProducto.Producto.Modelo</p>
                                            @* JS *@
                                            @* <a class="btn btn-danger flex-fill ms-1 remove-btn" id="removeItem" data-idsucursal="@ventaProducto.SucursalProducto.IdSucursalProducto">Eliminar articulo</a> *@
                                            @* Sin JS*@
                                            <a class="btn btn-danger flex-fill ms-1" asp-controller="Venta" asp-action="RemoveFromCart" asp-route-IdSucursalProducto="@ventaProducto.SucursalProducto.IdSucursalProducto">Eliminar </a>
                                            <!-- Data -->
                                        </div>

                                        <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
                                            <!-- Quantity -->
                                            <div class="d-flex mb-4" style="max-width: 300px">
                                                @* <button class="btn btn-primary px-3 me-2"
                                        onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                                        <i class="fas fa-minus"></i>
                                        </button> *@
                                                <button class="btn btn-primary px-3 me-2"
                                                        onclick="decrementar(@ventaProducto.SucursalProducto.IdSucursalProducto)">

                                                    <i class="fas fa-minus"></i>
                                                </button>

                                                <div class="form-outline">
                                                    <input id="form1-@ventaProducto.SucursalProducto.IdSucursalProducto" min="0" name="quantity" value="@ventaProducto.Cantidad" type="number" class="form-control" />
                                                    <label class="form-label" for="form1">Quantity</label>
                                                </div>

                                                <button class="btn btn-primary px-3 ms-2"
                                                        onclick="incrementar(@ventaProducto.SucursalProducto.IdSucursalProducto)">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                                @*
                                        <button class="btn btn-primary px-3 ms-2"
                                        onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                                        <i class="fas fa-plus"></i>
                                        </button> *@
                                            </div>
                                            <!-- Quantity -->
                                            <!-- Price -->
                                            <p class="text-start text-md-center">
                                                <strong>Subtotal: @(ventaProducto.Cantidad * ventaProducto.SucursalProducto.Producto.PrecioUnitario)</strong>
                                            </p>
                                            <!-- Price -->
                                            @{
                                                Total += (ventaProducto.Cantidad * ventaProducto.SucursalProducto.Producto.PrecioUnitario);
                                            }
                                        </div>
                                    </div>
                                    <!-- Single item -->
                                    <hr class="my-4" />
                                </div>
                            }
                        </div>
                        <div class="card mb-4">
                            <div class="card-body">
                                <p><strong>Expected shipping delivery</strong></p>
                                <p class="mb-0">12.10.2020 - 14.10.2020</p>
                            </div>
                        </div>
                        <div class="card mb-4 mb-lg-0">
                            <div class="card-body">
                                <p><strong>We accept</strong></p>
                                @*  <img class="me-2" width="45px"
                            src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/visa.svg"
                            alt="Visa" />
                            <img class="me-2" width="45px"
                            src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/amex.svg"
                            alt="American Express" />
                            <img class="me-2" width="45px"
                            src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/mastercard.svg"
                            alt="Mastercard" />
                            <img class="me-2" width="45px"
                            src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce/includes/gateways/paypal/assets/images/paypal.webp"
                            alt="PayPal acceptance mark" /> *@
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card mb-4">
                            <div class="card-header py-3">
                                <h5 class="mb-0">Summary</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                                        Products
                                        <span>$53.98</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                                        Shipping
                                        <span>Gratis</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                                        <div>
                                            <strong>Total amount</strong>
                                            <strong>
                                                <p class="mb-0">(including VAT)</p>
                                            </strong>
                                        </div>
                                        <span><strong>$@Total</strong></span>
                                        <span id="total-amount"><strong>$0.0</strong></span>
                                    </li>
                                </ul>

                                <button type="button" class="btn btn-primary btn-lg btn-block">
                                    Go to checkout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        @* <div id="alert-message" class="alert alert-dismissible fade show" role="alert" style="display: none;">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
    </button>
    <strong>¡Mensaje!</strong> <span id="alert-text"></span>
    </div> *@



    }
    else
    {
        <div class="row m-5">
            <div class="col">
                <div class="alert alert-danger" role="alert">Su carrito esta vacio :c</div>

            </div>
        </div>

    }


</div>


<!-- Incluye jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">

    @* $(document).ready(function () {
        $('.remove-btn').click(function (e) {
        e.preventDefault();
        var btnR = $(this);
        var idSucursalP = btnR.data('idsucursal'); *@
    @* var idSucursalP = $(this).data('idsucursal'); *@

    @*  $.ajax({
        type: 'POST',
        url: "@Url.Action("RemoveFromCart", "Venta")",
        data: { IdSucursalProducto: idSucursalP },
        success: function () {

        },
        error: function () {
        alert('error a traer los datos');

        }
        });
        });
        }); *@


        function incrementar(idSucursalProducto) {
            $.ajax({
                type: 'POST',
                url: "@Url.Action("AumentarCantidad", "Venta")",
                data: { IdSucursalProducto: idSucursalProducto, agregar: true },
                success: function () {
                    var elementoInput = $('#form1-' + idSucursalProducto);
                    var ValorActual = parseInt(elementoInput.val());
                    elementoInput.val(ValorActual + 1);
                },
                error: function () {
                    alert('error al incrementar');
                }
            });
        }

    function decrementar(idSucursalProducto) {
        $.ajax({
            type: 'POST',
            url: "@Url.Action("AumentarCantidad", "Venta")",
            data: { IdSucursalProducto: idSucursalProducto, agregar: false },
            success: function () {
                var elementoInput = $('#form1-' + idSucursalProducto);
                var ValorActual = parseInt(elementoInput.val());
                elementoInput.val(ValorActual - 1);
            },
            error: function () {
                alert('error al incrementar');
            }
            });
    }

    @* alerta *@
    $(document).ready(function () {
        var mensaje = "@ViewBag.Mensaje";
        if (mensaje) {

            $("#mensajeAlert").text(mensaje).addClass("show");
            setTimeout(function () {
                $("#mensajeAlert").removeClass("show");
            }, 5000);
        }
    });

    @* total *@
        $(document).ready(function () {
            var totalP = 0;
    @foreach (ML.VentaProducto ventaP in Model)
    {
        var subtotal = ventaP.Cantidad * ventaP.SucursalProducto.Producto.PrecioUnitario;
        @:totalP += @subtotal;
    }
                $("#total-amount").text("$" + total.toFixed(2));
        });

</script>
